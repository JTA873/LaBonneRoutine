<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription - La Bonne Routine</title>
    <meta name="description" content="Créez votre compte et établissons ensemble votre bilan sportif personnalisé">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <style>
        /* Styles spécifiques à la page d'inscription */
        body {
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            padding: 2rem 0;
        }

        .signup-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
        }

        .signup-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 3rem;
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .signup-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
        }

        .signup-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .logo-container {
            margin-bottom: 1.5rem;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #9E3728, #F59E0B);
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin: 0 auto;
            box-shadow: 0 15px 35px rgba(158, 55, 40, 0.3);
        }

        .signup-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #111111;
            margin-bottom: 0.5rem;
            font-family: 'Playfair Display', serif;
        }

        .signup-subtitle {
            color: #6B7280;
            font-size: 1.125rem;
            margin: 0;
            line-height: 1.6;
        }

        .form-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
            gap: 1rem;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            background: #F3F4F6;
            color: #6B7280;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .step.active {
            background: linear-gradient(135deg, #9E3728, #F59E0B);
            color: white;
            box-shadow: 0 5px 15px rgba(158, 55, 40, 0.3);
        }

        .step.completed {
            background: #D1FAE5;
            color: #065F46;
        }

        .step-number {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: currentColor;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .step.active .step-number,
        .step.completed .step-number {
            background: white;
            color: #9E3728;
        }

        .form-section {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .form-section.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111111;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-subtitle {
            color: #6B7280;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }

        .form-label.required::after {
            content: ' *';
            color: #DC2626;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 1rem;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 1rem;
            background: #FAFAFA;
            transition: all 0.3s ease;
            outline: none;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            border-color: #9E3728;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(158, 55, 40, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #FAFAFA;
        }

        .checkbox-item:hover {
            border-color: #9E3728;
            background: white;
        }

        .checkbox-item.checked {
            border-color: #9E3728;
            background: #FEF2F2;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #9E3728;
        }

        .radio-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #FAFAFA;
        }

        .radio-item:hover {
            border-color: #9E3728;
            background: white;
        }

        .radio-item.checked {
            border-color: #9E3728;
            background: #FEF2F2;
        }

        .radio-item input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #9E3728;
        }

        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            gap: 1rem;
        }

        .nav-btn {
            padding: 1rem 2rem;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            min-width: 120px;
        }

        .nav-btn.secondary {
            background: #F3F4F6;
            color: #374151;
        }

        .nav-btn.secondary:hover {
            background: #E5E7EB;
            transform: translateY(-2px);
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #9E3728, #7A2A1E);
            color: white;
        }

        .nav-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(158, 55, 40, 0.3);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .back-home {
            position: absolute;
            top: 2rem;
            left: 2rem;
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .back-home:hover {
            opacity: 0.8;
        }

        .error-message {
            background: #FEE2E2;
            border: 1px solid #FECACA;
            color: #DC2626;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: none;
            font-size: 0.875rem;
        }

        .success-message {
            background: #D1FAE5;
            border: 1px solid #A7F3D0;
            color: #065F46;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: none;
            font-size: 0.875rem;
        }

        .login-link {
            text-align: center;
            margin-top: 2rem;
            color: #6B7280;
            font-size: 0.875rem;
        }

        .login-link a {
            color: #9E3728;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .login-link a:hover {
            color: #7A2A1E;
        }

        /* Particules d'arrière-plan */
        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .signup-container {
                padding: 1rem;
            }

            .signup-card {
                padding: 2rem 1.5rem;
            }

            .signup-title {
                font-size: 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .form-steps {
                flex-direction: column;
                gap: 0.5rem;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .back-home {
                top: 1rem;
                left: 1rem;
            }

            .form-navigation {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Particules d'arrière-plan -->
    <div class="bg-particles" id="particles"></div>

    <!-- Lien retour -->
    <a href="index.html" class="back-home">
        ← Retour à l'accueil
    </a>

    <div class="signup-container">
        <div class="signup-card">
            <div class="signup-header">
                <div class="logo-container">
                    <div class="logo">LBR</div>
                </div>
                <h1 class="signup-title">Créer mon compte</h1>
                <p class="signup-subtitle">
                    Rejoignez La Bonne Routine et commençons ensemble votre transformation personnelle
                </p>
            </div>

            <!-- Étapes du formulaire -->
            <div class="form-steps">
                <div class="step active" id="step-1">
                    <span class="step-number">1</span>
                    <span>Informations personnelles</span>
                </div>
                <div class="step" id="step-2">
                    <span class="step-number">2</span>
                    <span>Bilan sportif</span>
                </div>
                <div class="step" id="step-3">
                    <span class="step-number">3</span>
                    <span>Objectifs & Préférences</span>
                </div>
            </div>

            <!-- Messages d'erreur/succès -->
            <div id="error-message" class="error-message"></div>
            <div id="success-message" class="success-message"></div>

            <form id="signupForm">
                <!-- ÉTAPE 1 : Informations personnelles -->
                <div class="form-section active" id="section-1">
                    <h2 class="section-title">
                        👤 Informations personnelles
                    </h2>
                    <p class="section-subtitle">
                        Commençons par faire connaissance ! Ces informations nous permettront de personnaliser votre expérience.
                    </p>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">Prénom</label>
                            <input 
                                type="text" 
                                id="firstName" 
                                name="firstName"
                                class="form-input" 
                                placeholder="Votre prénom"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Nom</label>
                            <input 
                                type="text" 
                                id="lastName" 
                                name="lastName"
                                class="form-input" 
                                placeholder="Votre nom"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Email</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email"
                                class="form-input" 
                                placeholder="votre@email.com"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label">Téléphone</label>
                            <input 
                                type="tel" 
                                id="phone" 
                                name="phone"
                                class="form-input" 
                                placeholder="06 12 34 56 78"
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label">Âge</label>
                            <input 
                                type="number" 
                                id="age" 
                                name="age"
                                class="form-input" 
                                placeholder="25"
                                min="16"
                                max="99"
                            >
                        </div>

                        <div class="form-group">
                            <label class="form-label">Genre</label>
                            <select id="gender" name="gender" class="form-select">
                                <option value="">Choisir</option>
                                <option value="femme">Femme</option>
                                <option value="homme">Homme</option>
                                <option value="autre">Autre</option>
                                <option value="non-specifie">Préfère ne pas répondre</option>
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label class="form-label required">Mot de passe</label>
                            <input 
                                type="password" 
                                id="password" 
                                name="password"
                                class="form-input" 
                                placeholder="Minimum 6 caractères"
                                required
                                minlength="6"
                            >
                        </div>

                        <div class="form-group full-width">
                            <label class="form-label required">Confirmer le mot de passe</label>
                            <input 
                                type="password" 
                                id="confirmPassword" 
                                name="confirmPassword"
                                class="form-input" 
                                placeholder="Répétez votre mot de passe"
                                required
                            >
                        </div>
                    </div>
                </div>

                <!-- ÉTAPE 2 : Bilan sportif -->
                <div class="form-section" id="section-2">
                    <h2 class="section-title">
                        🏃‍♀️ Votre bilan sportif
                    </h2>
                    <p class="section-subtitle">
                        Parlons de votre mode de vie actuel et de votre expérience sportive pour mieux vous accompagner.
                    </p>

                    <div class="form-group full-width">
                        <label class="form-label">Quel est votre mode de vie actuel ? (alimentation, sport, repos)</label>
                        <textarea 
                            id="lifestyle" 
                            name="lifestyle"
                            class="form-textarea" 
                            placeholder="Décrivez votre routine quotidienne : habitudes alimentaires, activité physique, sommeil, stress..."
                        ></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">As-tu fais des activités sportives par le passé ? Si oui, lesquelles ?</label>
                        <textarea 
                            id="sportHistory" 
                            name="sportHistory"
                            class="form-textarea" 
                            placeholder="Parlez-nous de votre parcours sportif : sports pratiqués, niveau, durée, ce que vous avez aimé ou moins aimé..."
                        ></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Qu'aimes-tu faire en général ?</label>
                        <textarea 
                            id="interests" 
                            name="interests"
                            class="form-textarea" 
                            placeholder="Vos loisirs, passions, activités préférées... Cela nous aide à personnaliser votre accompagnement !"
                        ></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Des pathologies / douleurs particulières à prendre en compte ?</label>
                        <textarea 
                            id="healthIssues" 
                            name="healthIssues"
                            class="form-textarea" 
                            placeholder="Blessures, douleurs chroniques, problèmes de santé, contre-indications médicales... (Ces informations restent confidentielles)"
                        ></textarea>
                    </div>
                </div>

                <!-- ÉTAPE 3 : Objectifs & Préférences -->
                <div class="form-section" id="section-3">
                    <h2 class="section-title">
                        🎯 Vos objectifs & préférences
                    </h2>
                    <p class="section-subtitle">
                        Définissons ensemble vos objectifs et la façon dont vous souhaitez être accompagné(e).
                    </p>

                    <div class="form-group full-width">
                        <label class="form-label">Objectifs sportifs</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="goals" value="perdre-poids">
                                <span>Perdre du poids</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="goals" value="se-raffermir">
                                <span>Se raffermir et prendre du muscle</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="goals" value="etre-en-forme">
                                <span>Être en forme simplement, bouger facilement</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="goals" value="endurance">
                                <span>Améliorer mon endurance</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="goals" value="force">
                                <span>Développer ma force</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="goals" value="souplesse">
                                <span>Gagner en souplesse et mobilité</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Tu préfères te faire coacher...</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="coachingLocation" value="exterieur">
                                <span>🌳 En extérieur</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="coachingLocation" value="salle">
                                <span>🏋️ En salle</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="coachingLocation" value="domicile">
                                <span>🏠 À domicile (Service à la personne disponible - 50% réduction d'impôt)</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="coachingLocation" value="distance">
                                <span>💻 À distance</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="coachingLocation" value="mixte">
                                <span>🔄 Mixte (selon les séances)</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Qu'attends-tu exactement d'un coach ?</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="expectations" value="motivation">
                                <span>💪 Motivation / boost</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="expectations" value="accompagnement">
                                <span>🎯 Accompagnement personnalisé / Te rendre autonome</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="expectations" value="bonne-humeur">
                                <span>😊 Bonne humeur, suivi de qualité et progression vers l'atteinte de ton objectif</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="expectations" value="technique">
                                <span>🔧 Apprentissage technique et sécurité</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="expectations" value="nutrition">
                                <span>🥗 Conseils nutritionnels</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="expectations" value="suivi">
                                <span>📊 Suivi régulier et adaptation du programme</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Informations complémentaires (optionnel)</label>
                        <textarea 
                            id="additionalInfo" 
                            name="additionalInfo"
                            class="form-textarea" 
                            placeholder="Tout ce que vous souhaitez nous faire savoir pour mieux vous accompagner..."
                        ></textarea>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="form-navigation">
                    <button type="button" class="nav-btn secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                        Précédent
                    </button>
                    <div></div>
                    <button type="button" class="nav-btn primary" id="nextBtn" onclick="nextStep()">
                        Suivant
                    </button>
                    <button type="submit" class="nav-btn primary" id="submitBtn" style="display: none;">
                        🚀 Créer mon compte
                    </button>
                </div>
            </form>

            <div class="login-link">
                Vous avez déjà un compte ? 
                <a href="login.html">Se connecter</a>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/firebase-init.js"></script>
    <script type="module">
        import { auth, db } from './js/firebase-init.js';
        import { 
            createUserWithEmailAndPassword,
            updateProfile,
            onAuthStateChanged
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { 
            doc, 
            setDoc,
            serverTimestamp
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        let currentStep = 1;
        const totalSteps = 3;

        // Éléments DOM
        const signupForm = document.getElementById('signupForm');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const errorMessage = document.getElementById('error-message');
        const successMessage = document.getElementById('success-message');

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            setupEventListeners();
            
            // Vérifier si l'utilisateur est déjà connecté
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    window.location.href = 'dashboard.html';
                }
            });
        });

        // Animation des particules
        function createParticles() {
            const particles = document.getElementById('particles');
            if (!particles) return;
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = Math.random() * 10 + 5 + 'px';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particles.appendChild(particle);
            }
        }

        // Configuration des événements
        function setupEventListeners() {
            // Gestion des checkbox et radio buttons
            document.querySelectorAll('.checkbox-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'INPUT') {
                        const checkbox = item.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                    }
                    item.classList.toggle('checked', item.querySelector('input').checked);
                });
            });

            document.querySelectorAll('.radio-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'INPUT') {
                        const radio = item.querySelector('input[type="radio"]');
                        radio.checked = true;
                    }
                    
                    // Réinitialiser tous les items du même groupe
                    const radioName = item.querySelector('input').name;
                    document.querySelectorAll(`input[name="${radioName}"]`).forEach(r => {
                        r.closest('.radio-item').classList.remove('checked');
                    });
                    
                    // Marquer l'item sélectionné
                    if (item.querySelector('input').checked) {
                        item.classList.add('checked');
                    }
                });
            });

            // Validation des mots de passe
            document.getElementById('confirmPassword').addEventListener('input', validatePasswords);
            document.getElementById('password').addEventListener('input', validatePasswords);

            // Soumission du formulaire
            signupForm.addEventListener('submit', handleSignup);
        }

        // Navigation entre les étapes
        window.nextStep = function() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateStepDisplay();
                }
            }
        };

        window.previousStep = function() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        };

        function updateStepDisplay() {
            // Masquer toutes les sections
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });

            // Afficher la section courante
            document.getElementById(`section-${currentStep}`).classList.add('active');

            // Mettre à jour les étapes
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });

            // Gérer les boutons de navigation
            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            nextBtn.style.display = currentStep < totalSteps ? 'block' : 'none';
            submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';
        }

        function validateCurrentStep() {
            hideMessages();
            
            if (currentStep === 1) {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (!firstName || !lastName || !email || !password || !confirmPassword) {
                    showMessage('Veuillez remplir tous les champs obligatoires', 'error');
                    return false;
                }

                if (password !== confirmPassword) {
                    showMessage('Les mots de passe ne correspondent pas', 'error');
                    return false;
                }

                if (password.length < 6) {
                    showMessage('Le mot de passe doit contenir au moins 6 caractères', 'error');
                    return false;
                }

                // Validation de l'email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showMessage('Veuillez entrer une adresse email valide', 'error');
                    return false;
                }
            }

            return true;
        }

        function validatePasswords() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (confirmPassword && password !== confirmPassword) {
                document.getElementById('confirmPassword').style.borderColor = '#DC2626';
            } else {
                document.getElementById('confirmPassword').style.borderColor = '#E5E7EB';
            }
        }

        // Collecte des données du formulaire
        function collectFormData() {
            const formData = new FormData(signupForm);
            const data = {};
            
            // Données basiques
            for (let [key, value] of formData.entries()) {
                if (key === 'goals' || key === 'expectations') {
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else {
                    data[key] = value;
                }
            }

            // Données de profil personnalisées
            data.profile = {
                personalInfo: {
                    firstName: data.firstName,
                    lastName: data.lastName,
                    age: data.age ? parseInt(data.age) : null,
                    gender: data.gender,
                    phone: data.phone
                },
                sportProfile: {
                    lifestyle: data.lifestyle,
                    sportHistory: data.sportHistory,
                    interests: data.interests,
                    healthIssues: data.healthIssues
                },
                preferences: {
                    goals: data.goals || [],
                    coachingLocation: data.coachingLocation,
                    expectations: data.expectations || [],
                    additionalInfo: data.additionalInfo
                },
                createdAt: serverTimestamp(),
                profileCompleted: true
            };

            return data;
        }

        // Gestion de l'inscription
        async function handleSignup(e) {
            e.preventDefault();
            
            if (!validateCurrentStep()) {
                return;
            }

            const formData = collectFormData();
            
            setLoading(true);
            hideMessages();

            try {
                // Créer le compte utilisateur
                const userCredential = await createUserWithEmailAndPassword(
                    auth, 
                    formData.email, 
                    formData.password
                );

                const user = userCredential.user;

                // Mettre à jour le profil
                await updateProfile(user, {
                    displayName: `${formData.firstName} ${formData.lastName}`
                });

                // Sauvegarder les données du profil dans Firestore
                await setDoc(doc(db, 'users', user.uid), {
                    ...formData.profile,
                    email: formData.email,
                    uid: user.uid,
                    role: 'user',
                    createdAt: serverTimestamp()
                });

                showMessage('Compte créé avec succès ! Redirection...', 'success');
                
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);

            } catch (error) {
                console.error('Erreur lors de l\'inscription:', error);
                let message = 'Erreur lors de la création du compte';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        message = 'Cette adresse email est déjà utilisée';
                        break;
                    case 'auth/invalid-email':
                        message = 'Adresse email invalide';
                        break;
                    case 'auth/weak-password':
                        message = 'Le mot de passe est trop faible';
                        break;
                    default:
                        message = error.message || 'Erreur lors de la création du compte';
                }
                
                showMessage(message, 'error');
            } finally {
                setLoading(false);
            }
        }

        // Fonctions utilitaires
        function setLoading(loading) {
            if (submitBtn) {
                if (loading) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Création du compte...';
                } else {
                    submitBtn.disabled = false;
                    submitBtn.textContent = '🚀 Créer mon compte';
                }
            }
            
            if (nextBtn) {
                nextBtn.disabled = loading;
            }
        }

        function showMessage(message, type = 'error') {
            hideMessages();
            const messageEl = type === 'error' ? errorMessage : successMessage;
            if (messageEl) {
                messageEl.textContent = message;
                messageEl.style.display = 'block';
                
                // Faire défiler vers le message
                messageEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Auto-hide après 8 secondes pour les messages de succès
                if (type === 'success') {
                    setTimeout(hideMessages, 8000);
                }
            }
        }

        function hideMessages() {
            if (errorMessage) errorMessage.style.display = 'none';
            if (successMessage) successMessage.style.display = 'none';
        }
    </script>
</body>
</html>
